<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrintCloud</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="header.css">
    <link rel="icon" type="image/x-icon" href="picture/logo.png">
    <% if (userFound) { %>
        <p id="username" style="display:none"><%= userFound.user %></p>
        <p id="pas" style="display:none"><%= userFound.password %></p>
        <p id="email" style="display:none"><%= userFound.email %></p>
    <% } %>
</head>
<body>
    <script type="module" src="js/model-viewer.js"></script>
    <script src="js/index.js"></script>
    <script src="js/languare.js"></script>
    <script type="module">
      import { showView } from "./js/model-viewer.js";
      window.showView = showView;
    </script>
    

    <header>
        <div class="headerb2">
            <select class="headerb" id="lang" onchange="serLanguare()">
                <option selected>Deutsch</option>
                <option>Englisch</option>
            </select>
            <form class="headerb" action="modells">
                <input name="search"  placeholder="Search..." type="search">
            </form>
            <% if (userFound) { %>
                <p id="username" style="display:none"><%= userFound.username %></p>
                <p id="email" style="display:none"><%= userFound.email %></p>
                <p id="pas" style="display:none"><%= userFound.password %></p>
                <p>Hallo, <%= userFound.username %></p>
                <button onclick="logout()">Logout</button>
                <a href="cratemodell">
                    <button class="headerb">Erstellen</button>
                </a>
            <% } else { %>
                <a class="headerb" href="login">
                    <img class="aimg" src="/picture/accounnt.png" alt="">
                </a>
            <% } %>
            
            
        </div>  
        <div class="headera2">
            <a class="headera" id="home" href="/">Home</a>
            <a class="headera" id="comunity" href="comunity">Comunity</a>
            <a class="headera" id="modells" href="modells">Modells</a>
        </div>    
    </header>
    <main>
        <section>
            <div id="model-list-1">
              
  
                <div class="model-container">
                 
                  
                  
                  
                  <div id="container3D" data-modelfile="/models/file/<%= model.dataFiles[0] %>" style="display: none;"></div>
                  <br>
                  <img id="mainImage" src="/models/file/<%= model.pictureFiles[0] %>" class="model-image" alt="Modellbild" style="width: 400px; height: 400px; object-fit: contain; background-color: white;">
                  
                  <div style="margin-top: 10px;">
                    <% model.pictureFiles.forEach(picture => { %>
                      <img src="/models/file/<%= picture %>" class="thumb-image" alt="Thumbnail"
                          style="width: 80px; height: 80px; object-fit: cover; margin-right: 5px; cursor: pointer;"
                          onclick="switchToImageView('/models/file/<%= picture %>')">
                    <% }); %>
                    <div>
                      <button id="toggleButton" onclick="toggleView()">3D-Modell anzeigen</button>
                      <select id="modelSelect" onchange="changeModel()" style="display:none; margin-left:10px;">
                        <% model.dataFiles.forEach(file => { %>
                          <option value="/models/file/<%= file %>"><%= file %></option>
                        <% }); %>
                      </select>
                    </div>
                  </div>
                  
                  
                    <!-- Rechts daneben: Name, Download, Likes -->
                    <div class="model-meta">
                      <strong><%= model.name %></strong><br>
                      <strong>By: <%= model.userb %></strong><br>
                  
                      <a class="download-link" href="#mdownl" >
                        <button onclick="showContent('model')">Download</button>
                      </a>
                      <form action="/like" method="get">
                        <input type="hidden" name="id" value="<%= model.id %>">
                        
                        <% if (userFound && model.likes && model.likes[userFound.email]) { %> 
                          <!-- Wenn der Benutzer bereits geliked hat, kann er entliken -->
                          <input type="radio" name="like" value="off" id="like" onchange="this.form.submit()">
                          <p><%= model.like %> üëç</p>
                          <label for="like">Entlike</label>
                        <% } else { %> 
                          <!-- Wenn der Benutzer das Modell noch nicht geliked hat -->
                          <input type="radio" name="like" value="on" id="like" onchange="this.form.submit()">
                          <p><%= model.like %> üëç</p>
                          <label for="like">Like</label>
                        <% } %>  
                      </form>
                      <label><%= model.download %> ‚¨áÔ∏è</label>
                    </div>
              </div>
             
            
    
        </section>
        <section class="model-below">
            <button onclick="showContent('model')">Modell</button>
            <button onclick="showContent('besch')">Beschreibung</button>
            <button onclick="showContent('div1')">Weitere Info</button>
          
            <div id="model" class="content"  >
              <h3>Models</h3><br><br>
              <h3 id="mdownl">Dateien</h3><br>
              <% model.dataFiles.forEach(file => { %>
                <form action="/download" method="get" target="_blank" style="display:inline;">
                  <input type="hidden" name="id" value="<%= model.id %>">
                  <input type="hidden" name="file" value="<%= file %>">
                  <button><%= file %></button>
                </form>
              <% }); %>
                
              
            </div>
          
            <div id="besch" class="content">
              <h3>Beschreibung</h3><br><br>
              <p class="deteil2"><%= model.description %></p><br>
            </div>
          
            <div id="div1" class="content">
              <h3>User</h3>
              <strong>By: <%= model.userb %></strong>
            </div>
          </section>
          
          <style>
            .content {
              display: none;
              padding: 15px;
              border: 1px solid #ccc;
              margin-top: 10px;
            }
            .content.active {
              display: block;
            }
          </style>
          
          <script>
            showContent('model');
            function showContent(id) {
              const contents = document.querySelectorAll('.content');
              contents.forEach(div => div.classList.remove('active'));
              document.getElementById(id).classList.add('active');
            }
          </script>
    </main>
</body>
</html>